<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö—Ä–∞—Ñ—Ç –•–∞–±</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤ Telegram –¥–ª—è –±–µ—Å—à–æ–≤–Ω–æ–≥–æ –¥–∏–∑–∞–π–Ω–∞ */
        :root {
            --bg-color: var(--tg-theme-bg-color, #ffffff);
            --secondary-bg: var(--tg-theme-secondary-bg-color, #f4f4f5);
            --text-color: var(--tg-theme-text-color, #000000);
            --hint-color: var(--tg-theme-hint-color, #999999);
            --link-color: var(--tg-theme-link-color, #248bed);
            --button-color: var(--tg-theme-button-color, #248bed);
            --button-text: var(--tg-theme-button-text-color, #ffffff);
            --header-height: 100px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0; padding: 0;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            scroll-behavior: smooth;
        }

        /* –®–∞–ø–∫–∞ */
        header {
            background-color: var(--bg-color);
            position: sticky; top: 0; z-index: 100;
            padding: 12px;
            text-align: center;
            font-weight: 600;
            border-bottom: 0.5px solid rgba(0,0,0,0.1);
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π */
        .nav-tabs {
            display: flex;
            overflow-x: auto;
            background-color: var(--bg-color);
            padding: 8px 12px;
            gap: 8px;
            position: sticky;
            top: 45px; /* –°—Ä–∞–∑—É –ø–æ–¥ —Ö–µ–¥–µ—Ä–æ–º */
            z-index: 99;
            border-bottom: 0.5px solid rgba(0,0,0,0.1);
        }
        .nav-tabs::-webkit-scrollbar { display: none; }

        .nav-btn {
            padding: 6px 16px;
            background-color: var(--secondary-bg);
            color: var(--text-color);
            border-radius: 16px;
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
            white-space: nowrap;
            transition: all 0.2s ease;
        }
        .nav-btn.active {
            background-color: var(--button-color);
            color: var(--button-text);
        }

        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç—Å—Ç—É–ø–∞ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ (—á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–ª–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏) */
        .section-anchor {
            scroll-margin-top: 110px;
        }

        .category-header {
            padding: 20px 16px 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--hint-color);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* –û–ø—Ü–∏–∏ –∑–∞–∫–∞–∑–∞ */
        .options-block {
            background-color: var(--secondary-bg);
            margin: 12px;
            padding: 12px;
            border-radius: 12px;
        }
        .options-block select {
            width: 100%;
            background: none;
            border: none;
            color: var(--link-color);
            font-size: 16px;
            outline: none;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞ */
        .item-card {
            display: flex;
            padding: 12px 16px;
            gap: 12px;
            border-bottom: 0.5px solid rgba(0,0,0,0.05);
            align-items: center;
        }

        .item-img {
            width: 80px; height: 80px;
            border-radius: 10px;
            background-color: var(--secondary-bg);
            background-size: cover;
            background-position: center;
            flex-shrink: 0;
        }

        .item-info { flex-grow: 1; }
        .item-title { font-size: 16px; font-weight: 500; margin-bottom: 4px; }
        .item-desc { font-size: 13px; color: var(--hint-color); line-height: 1.2; }

        .item-controls {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 8px;
            min-width: 80px;
        }

        .price { font-weight: 600; font-size: 15px; }

        /* –ö–Ω–æ–ø–∫–∏ –∏ —Å—á–µ—Ç—á–∏–∫ */
        .add-btn {
            background-color: var(--secondary-bg);
            color: var(--link-color);
            border: none;
            padding: 5px 15px;
            border-radius: 14px;
            font-weight: 600;
            font-size: 14px;
            transition: opacity 0.2s;
        }
        .add-btn:active { opacity: 0.7; }

        .counter {
            display: none;
            align-items: center;
            background-color: var(--button-color);
            color: var(--button-text);
            border-radius: 14px;
            padding: 3px;
        }
        .counter button {
            background: none; border: none;
            color: var(--button-text);
            font-size: 18px; font-weight: bold;
            width: 30px; height: 24px;
            cursor: pointer;
        }
        .count-num { width: 20px; text-align: center; font-weight: 600; }

        /* –û—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ TG */
        .bottom-space { height: 80px; }
    </style>
</head>
<body>

<header>–ö—Ä–∞—Ñ—Ç –•–∞–±</header>

<div class="nav-tabs" id="nav-tabs"></div>

<div class="options-block">
    <div style="font-size: 12px; color: var(--hint-color); margin-bottom: 4px;">–í–†–ï–ú–Ø –ü–û–î–ê–ß–ò</div>
    <select id="order-time">
        <option value="üçΩ –ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é">–ö –º–æ–µ–º—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é</option>
        <option value="üöÄ –ö–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ">–ö–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ</option>
    </select>
</div>

<div id="menu-list"></div>
<div class="bottom-space"></div>

<script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();
    tg.MainButton.setParams({ color: tg.themeParams.button_color });

    const categories = {
        'mangal': 'üî• –ú–∞–Ω–≥–∞–ª',
        'sets': 'üì¶ –°–µ—Ç—ã',
        'snacks': 'üç∫ –ó–∞–∫—É—Å–∫–∏'
    };

    const menuItems = [
        { id: 'ribs', iiko_id: '', img: '', title: '–†—ë–±—Ä—ã—à–∫–∏ –Ω–∞ –º–∞–Ω–≥–∞–ª–µ', price: 560, category: 'mangal', desc: '–°–≤–∏–Ω—ã–µ —Ä–µ–±—Ä–∞ (200–≥)' },
        { id: 'sausages', iiko_id: '', img: '', title: '–ö–æ–ª–±–∞—Å–∫–∏ –Ω–∞ —É–≥–ª—è—Ö', price: 570, category: 'mangal', desc: '–ê—Å—Å–æ—Ä—Ç–∏ 4 –≤–∏–¥–∞ (230/30–≥)' },
        { id: 'wings', iiko_id: '', img: '', title: '–ö—É—Ä–∏–Ω—ã–µ –∫—Ä—ã–ª—å—è', price: 420, category: 'mangal', desc: '–ó–∞–ø–µ—á–µ–Ω–Ω—ã–µ —Å –¥—ã–º–∫–æ–º (200–≥)' },
        
        { id: 'set1', iiko_id: '', img: '', title: '–°–µ—Ç 1', price: 1550, category: 'sets', desc: '–ù–∏—Ç–∏, —Å—É–¥–∂—É–∫, —á–∏–ø—Å—ã, –≥—Ä–µ–Ω–∫–∏, –∫—Ä—ã–ª—å—è' },
        { id: 'set2', iiko_id: '', img: '', title: '–°–µ—Ç 2', price: 790, category: 'sets', desc: '–ß–∏–ø—Å—ã, —à–∞—Ä–∏–∫–∏, –∫–æ–ª—å—Ü–∞, —Ç–∞—Ä-—Ç–∞—Ä' },
        { id: 'set3', iiko_id: '', img: '', title: '–°–µ—Ç 3', price: 1150, category: 'sets', desc: '–†–µ–±—Ä–∞, –∫–æ–ª–±–∞—Å–∫–∏, –≥—Ä–µ–Ω–∫–∏, BBQ' },
        { id: 'set4', iiko_id: '', img: '', title: '–°–µ—Ç 4', price: 850, category: 'sets', desc: '–ù–∏—Ç–∏, —á–∏–ø—Å—ã, —Å—É–¥–∂—É–∫, –æ—Ä–µ—Ö–∏' },
        
        { id: 'chips', iiko_id: '', img: '', title: '–ß–∏–ø—Å—ã (30–≥)', price: 130, category: 'snacks' },
        { id: 'shrimp_chips', iiko_id: '', img: '', title: '–ö—Ä–µ–≤–µ—Ç–æ—á–Ω—ã–µ —á–∏–ø—Å—ã', price: 120, category: 'snacks' },
        { id: 'croutons', iiko_id: '', img: '', title: '–ì—Ä–µ–Ω–∫–∏', price: 180, category: 'snacks' },
        { id: 'cheese_threads', iiko_id: '', img: '', title: '–°—ã—Ä–Ω—ã–µ –Ω–∏—Ç–∏', price: 180, category: 'snacks' },
        { id: 'cheese_balls', iiko_id: '', img: '', title: '–°—ã—Ä–Ω—ã–µ —à–∞—Ä–∏–∫–∏', price: 230, category: 'snacks' },
        { id: 'meat_chips_pork', iiko_id: '', img: '', title: '–ú—è—Å–Ω—ã–µ —á–∏–ø—Å—ã (—Å–≤)', price: 260, category: 'snacks' },
        { id: 'meat_chips_chicken', iiko_id: '', img: '', title: '–ú—è—Å–Ω—ã–µ —á–∏–ø—Å—ã (–∫—É—Ä)', price: 260, category: 'snacks' },
        { id: 'sudzhuk', iiko_id: '', img: '', title: '–°—É–¥–∂—É–∫', price: 360, category: 'snacks' },
        { id: 'peanuts', iiko_id: '', img: '', title: '–ê—Ä–∞—Ö–∏—Å', price: 390, category: 'snacks' },
        { id: 'pistachios', iiko_id: '', img: '', title: '–§–∏—Å—Ç–∞—à–∫–∏', price: 390, category: 'snacks' },
        { id: 'shrimp_snack', iiko_id: '', img: '', title: '–ö—Ä–µ–≤–µ—Ç–∫–∏', price: 560, category: 'snacks' }
    ];

    let cart = {};

    function render() {
        const nav = document.getElementById('nav-tabs');
        const list = document.getElementById('menu-list');
        
        Object.entries(categories).forEach(([id, name]) => {
            nav.innerHTML += `<a href="#cat-${id}" class="nav-btn" onclick="highlightNav(this)">${name}</a>`;
            
            const items = menuItems.filter(i => i.category === id);
            list.innerHTML += `<div id="cat-${id}" class="section-anchor"><div class="category-header">${name}</div></div>`;
            
            items.forEach(item => {
                list.innerHTML += `
                    <div class="item-card">
                        <div class="item-img" style="background-image: url('${item.img || 'https://via.placeholder.com/100?text=Food'}')"></div>
                        <div class="item-info">
                            <div class="item-title">${item.title}</div>
                            <div class="item-desc">${item.desc || ''}</div>
                        </div>
                        <div class="item-controls">
                            <div class="price">${item.price} ‚ÇΩ</div>
                            <button class="add-btn" id="add-${item.id}" onclick="updateCart('${item.id}', 1)">–î–æ–±–∞–≤–∏—Ç—å</button>
                            <div class="counter" id="cnt-${item.id}">
                                <button onclick="updateCart('${item.id}', -1)">‚àí</button>
                                <span class="count-num" id="num-${item.id}">0</span>
                                <button onclick="updateCart('${item.id}', 1)">+</button>
                            </div>
                        </div>
                    </div>`;
            });
        });
    }

    function highlightNav(el) {
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        tg.HapticFeedback.impactOccurred('light');
    }

    function updateCart(id, delta) {
        cart[id] = (cart[id] || 0) + delta;
        const addBtn = document.getElementById(`add-${id}`);
        const counter = document.getElementById(`cnt-${id}`);
        const num = document.getElementById(`num-${id}`);

        if (cart[id] > 0) {
            addBtn.style.display = 'none';
            counter.style.display = 'flex';
            num.innerText = cart[id];
        } else {
            delete cart[id];
            addBtn.style.display = 'block';
            counter.style.display = 'none';
        }
        
        tg.HapticFeedback.selectionChanged();
        updateMainBtn();
    }

    function updateMainBtn() {
        let total = 0;
        for (const id in cart) {
            total += menuItems.find(i => i.id === id).price * cart[id];
        }
        if (total > 0) {
            tg.MainButton.setText(`–ü–û–î–¢–í–ï–†–î–ò–¢–¨ –ó–ê–ö–ê–ó ‚Äî ${total} ‚ÇΩ`);
            tg.MainButton.show();
        } else {
            tg.MainButton.hide();
        }
    }

   tg.onEvent('mainButtonClicked', () => {
        let total = 0; // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Ç–æ–≥–æ–≤–æ–π —Å—É–º–º—ã
        
        const order = Object.entries(cart).map(([id, count]) => {
            const item = menuItems.find(i => i.id === id);
            if (item) {
                total += item.price * count; // –°—á–∏—Ç–∞–µ–º —Å—É–º–º—É –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏
                return { 
                    title: item.title, 
                    count: count, 
                    price: item.price 
                };
            }
        });

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±—ä–µ–∫—Ç, –≤ –∫–æ—Ç–æ—Ä–æ–º —Ç–µ–ø–µ—Ä—å —Ç–æ—á–Ω–æ –µ—Å—Ç—å totalPrice
        tg.sendData(JSON.stringify({ 
            order: order, 
            totalPrice: total, // –¢–µ–ø–µ—Ä—å –±–æ—Ç —É–≤–∏–¥–∏—Ç —ç—Ç—É —Å—É–º–º—É
            time: document.getElementById('order-time').value 
        }));
    });

    render();
    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–µ—Ä–≤—ã–π —Ç–∞–± –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    const firstTab = document.querySelector('.nav-btn');
    if (firstTab) firstTab.classList.add('active');
</script>
</body>
</html>
